
### 核心思想：声明式配置

在 K8s 中，最推荐、最常见的操作方式是**声明式**的。这意味着你通常会编写一个 YAML 文件来“声明”你想要的最终状态，然后使用 `kubectl apply -f <your-file.yaml>` 命令让 K8s 去实现这个状态。下面的很多“创建/更新”操作都遵循这个模式。

---

### 1. Namespace (命名空间)

*   **资源简介**: 用于在集群内部创建逻辑上的资源隔离分区。就像电脑里的文件夹，用来组织和隔离不同项目、团队或环境（如开发、测试、生产）的资源。

| 操作 (Operation) | 常用命令 (Common Command)                                             | 作用与效果 (Purpose & Effect)                                                                                          |
| :------------- | :---------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------- |
| **查看所有**       | `kubectl get namespace` (或 `get ns`)                              | **作用**: 列出集群中所有的命名空间。<br>**效果**: 终端会显示一个列表，包含 `default`, `kube-system` 等系统自带的以及用户创建的命名空间。                         |
| **创建**         | `kubectl create namespace <my-namespace>`                         | **作用**: 快速创建一个新的命名空间。<br>**效果**: 集群中会新增一个名为 `<my-namespace>` 的空命名空间，之后可以在其中部署应用。                                  |
| **切换默认**       | `kubectl config set-context --current --namespace=<my-namespace>` | **作用**: 将当前 `kubectl` 的操作上下文切换到指定的命名空间，避免后续命令都要加 `-n` 参数。<br>**效果**: 后续所有 `kubectl` 命令默认都会在 `<my-namespace>` 中执行。 |
| **在指定空间操作**    | `kubectl get pods -n <my-namespace>`                              | **作用**: 在不切换上下文的情况下，对特定命名空间执行操作。`-n` 是 `--namespace` 的缩写，非常常用。<br>**效果**: 命令只会在 `<my-namespace>` 中查找和操作资源。        |
| **删除**         | `kubectl delete namespace <my-namespace>`                         | **作用**: 删除一个命名空间。<br>**效果**: **这是一个危险操作！** 该命名空间及其内部的所有资源（Pods, Services, Deployments 等）都会被删除。                    |

---

### 2. Pod (以及更常用的 Deployment)

*   **资源简介**: Pod 是 K8s 中最小的部署单元。但用户**极少直接创建 Pod**，而是通过 **Deployment** 来管理 Pod 的生命周期、副本数量和更新策略。所以我们重点讲 Deployment。

| 操作 (Operation) | 常用命令 (Common Command) | 作用与效果 (Purpose & Effect) |
| :--- | :--- | :--- |
| **查看** | `kubectl get pods [-n <namespace>]` | **作用**: 查看指定命名空间下的所有 Pod 状态。<br>**效果**: 显示 Pod 列表及其状态（如 `Running`, `Pending`, `CrashLoopBackOff`）、重启次数、运行时长等。 |
| **创建/更新应用** | `kubectl apply -f deployment.yaml` | **作用**: **最核心的命令**。通过 YAML 文件来创建或更新一个 Deployment。<br>**效果**: K8s 会根据 YAML 文件创建或调整 Pod 副本，使其达到期望状态。如果是更新，会触发滚动更新，保证服务不中断。 |
| **查看应用状态** | `kubectl get deployment` | **作用**: 查看 Deployment 的状态。<br>**效果**: 显示期望的副本数、当前副本数、可用副本数等，快速判断应用是否部署成功。 |
| **调试-查看详情** | `kubectl describe pod <pod-name>` | **作用**: 获取 Pod 的详细信息，是**排错第一步**。<br>**效果**: 显示 Pod 的配置、状态、最近的事件（Events），可以看到为什么 Pod 启动失败（如镜像拉取失败、资源不足等）。 |
| **调试-查看日志** | `kubectl logs <pod-name> [-f]` | **作用**: 查看 Pod 中容器的标准输出日志。`-f` 表示持续跟踪新日志。<br>**效果**: 实时看到应用程序打印的日志，用于调试业务逻辑问题。 |
| **调试-进入容器** | `kubectl exec -it <pod-name> -- /bin/sh` | **作用**: 在运行中的容器内启动一个交互式的 Shell 会话，就像 SSH 登录一样。<br>**效果**: 进入容器内部，可以查看文件、执行命令、诊断网络等。 |
| **删除** | `kubectl delete -f deployment.yaml` (或 `kubectl delete deployment <name>`) | **作用**: 删除一个 Deployment。<br>**效果**: Deployment 会被删除，它所管理的所有 Pod 也会被一并删除。 |

---

### 3. Service (服务)

*   **资源简介**: 为一组 Pod 提供一个稳定、统一的访问入口。它解决了 Pod IP 会变化的问题，并提供负载均衡。

| 操作 (Operation) | 常用命令 (Common Command) | 作用与效果 (Purpose & Effect) |
| :--- | :--- | :--- |
| **查看** | `kubectl get service` (或 `get svc`) | **作用**: 查看当前命名空间下的所有 Service。<br>**效果**: 显示 Service 的名称、类型（`ClusterIP`, `NodePort`, `LoadBalancer`）、虚拟 IP、端口等信息。 |
| **创建/更新** | `kubectl apply -f service.yaml` | **作用**: 通过 YAML 文件创建或更新一个 Service。<br>**效果**: K8s 会创建一个 Service，并根据其 `selector` 找到匹配的 Pod，将流量转发给它们。集群内的其他应用可以通过 Service 的名称（DNS）来访问它。 |
| **查看详情** | `kubectl describe svc <service-name>` | **作用**: 查看 Service 的详细配置和状态。<br>**效果**: 显示 Service 的标签选择器、端口映射，以及最重要的 **Endpoints**（即它当前代理的后端 Pod 的 IP 地址列表）。 |
| **删除** | `kubectl delete svc <service-name>` | **作用**: 删除一个 Service。<br>**效果**: 访问该 Service 的入口被移除，但后端的 Pod 不受影响，它们仍然在运行。 |

---

### 4. PVC (PersistentVolumeClaim - 持久化存储声明)

*   **资源简介**: Pod 用于“申请”持久化存储的“请求单”。它让应用开发者无需关心底层存储的具体实现（是云盘还是 NFS），只需声明需要多大空间、何种访问模式即可。

| 操作 (Operation) | 常用命令 (Common Command) | 作用与效果 (Purpose & Effect) |
| :--- | :--- | :--- |
| **查看** | `kubectl get pvc` | **作用**: 查看命名空间下的所有存储声明。<br>**效果**: 显示 PVC 的名称、状态（`Pending`表示等待绑定, `Bound`表示已绑定到存储卷）、容量等。 |
| **创建** | `kubectl apply -f pvc.yaml` | **作用**: 提交一个存储申请。<br>**效果**: K8s 会在后台寻找一个符合条件的 **PersistentVolume (PV)** 与之绑定。一旦绑定成功，Pod 就可以挂载这个 PVC 来使用持久化存储了。 |
| **删除** | `kubectl delete pvc <pvc-name>` | **作用**: 删除一个存储声明。<br>**效果**: PVC 对象被删除。根据后端存储卷的回收策略（ReclaimPolicy），底层的物理存储**可能被保留、回收或删除**。 |

---

### 5. Ingress (入口)

*   **资源简介**: 管理从集群外部到集群内部 Service 的 HTTP/HTTPS 流量。可以实现基于域名的虚拟主机、SSL 终止和路径路由等 L7 功能。

| 操作 (Operation) | 常用命令 (Common Command) | 作用与效果 (Purpose & Effect) |
| :--- | :--- | :--- |
| **查看** | `kubectl get ingress` (或 `get ing`) | **作用**: 查看 Ingress 规则。<br>**效果**: 显示所有 Ingress 规则，包括配置的主机名（HOSTS）、外部访问地址（ADDRESS）、端口等。 |
| **创建/更新** | `kubectl apply -f ingress.yaml` | **作用**: 定义外部流量如何路由到内部 Service。<br>**效果**: 集群中的 Ingress Controller（如 Nginx Ingress Controller）会读取这个规则，并更新其配置。这样，当用户访问 `http://<your-host>/<path>` 时，流量就会被正确转发到指定的 Service。 |
| **删除** | `kubectl delete ingress <ingress-name>` | **作用**: 删除一个 Ingress 规则。<br>**效果**: 外部访问该应用的路径失效，但内部的 Service 和 Pod 仍然存在。 |

---

### 6. Helm (K8s 的包管理器)

*   **简介**: Helm 不是 K8s 的原生资源，而是一个**独立的工具**，是 K8s 的“应用商店”和“安装向导”。它将一个复杂应用所需的所有 K8s 资源（Deployment, Service, PVC, Ingress等）打包成一个称为 **Chart** 的模板，极大简化了应用的部署和管理。

| 操作 (Operation) | 常用命令 (Common Command) | 作用与效果 (Purpose & Effect) |
| :--- | :--- | :--- |
| **安装应用** | `helm install <release-name> <chart-name>` (例如: `helm install my-redis bitnami/redis`) | **作用**: 一键部署一个预先打包好的应用（Chart）。<br>**效果**: Helm 会根据 Chart 的模板和你的配置，渲染出一系列 K8s YAML 文件，并帮你执行 `kubectl apply`。一个复杂的应用（如 Redis 集群）瞬间就部署好了。 |
| **查看已安装** | `helm list [-n <namespace>]` | **作用**: 列出通过 Helm 安装的所有应用（称为 Release）。<br>**效果**: 显示每个 Release 的名称、版本、状态等。 |
| **升级应用** | `helm upgrade <release-name> <chart-name> --values values.yaml` | **作用**: 升级一个已安装的应用，比如更新镜像版本或修改配置。<br>**效果**: Helm 会计算出新旧版本的差异，并只更新需要变更的 K8s 资源。 |
| **卸载应用** | `helm uninstall <release-name>` | **作用**: 卸载一个通过 Helm 部署的应用。<br>**效果**: Helm 会干净地删除掉当初通过它创建的所有相关 K8s 资源（Deployment, Service, PVC 等）。 |



---

### 7. ConfigMap (配置映射)

*   **资源简介**: 用于存储非敏感的配置数据，如键值对或配置文件。它将配置与应用程序代码解耦，使得配置变更无需重新构建镜像。

| 操作 (Operation) | 常用命令 (Common Command) | 作用与效果 (Purpose & Effect) |
| :--- | :--- | :--- |
| **查看** | `kubectl get configmap` (或 `get cm`) | **作用**: 查看当前命名空间下的所有 ConfigMap。<br>**效果**: 显示 ConfigMap 列表，包括其名称和包含的数据项数量。 |
| **创建 (从文件)** | `kubectl create cm <name> --from-file=<path-to-file>` | **作用**: 从一个或多个文件快速创建一个 ConfigMap。<br>**效果**: 文件名成为 key，文件内容成为 value，并创建一个名为 `<name>` 的 ConfigMap。 |
| **创建 (从字面值)** | `kubectl create cm <name> --from-literal=<key>=<value>` | **作用**: 从命令行直接提供键值对来创建 ConfigMap。<br>**效果**: 快速创建一个包含指定键值对的 ConfigMap，适合简单的配置。 |
| **创建/更新 (声明式)** | `kubectl apply -f configmap.yaml` | **作用**: **推荐方式**。通过 YAML 文件定义和管理 ConfigMap。<br>**效果**: 创建或更新 ConfigMap。Pod 可以通过环境变量或挂载为文件的方式使用这些配置。更新 ConfigMap 后，挂载的 Pod 可能需要重启才能加载新配置。 |
| **查看详情** | `kubectl describe cm <name>` | **作用**: 查看 ConfigMap 的详细信息，包括其包含的所有数据。<br>**效果**: 显示 ConfigMap 的元数据和 `Data` 部分，可以看到具体的键值内容。 |
| **删除** | `kubectl delete cm <name>` | **作用**: 删除一个 ConfigMap。<br>**效果**: ConfigMap 对象被删除。如果还有 Pod 正在使用它，可能会导致该 Pod 启动失败或运行时出错。 |

---

### 8. Secret (保密字典)

*   **资源简介**: 专门用于存储敏感数据，如密码、OAuth 令牌、SSH 密钥等。数据以 Base64 编码存储，提供了基本的混淆，但**不是加密**。其真正的安全在于 K8s 的 RBAC 权限控制和 etcd 加密等机制。

| 操作 (Operation) | 常用命令 (Common Command) | 作用与效果 (Purpose & Effect) |
| :--- | :--- | :--- |
| **查看** | `kubectl get secret` | **作用**: 查看当前命名空间下的所有 Secret。<br>**效果**: 显示 Secret 列表，包括其名称和类型（如 `Opaque`, `kubernetes.io/dockerconfigjson`）。 |
| **创建 (通用)** | `kubectl create secret generic <name> --from-literal=<key>=<value>` | **作用**: 创建一个通用的 Secret，用于存放自定义的敏感信息。<br>**效果**: 值会自动进行 Base64 编码后存储。 |
| **创建 (镜像仓库)** | `kubectl create secret docker-registry <name> --docker-server=...` | **作用**: 创建一个用于从私有镜像仓库拉取镜像的凭证。<br>**效果**: Pod 在其定义中引用这个 Secret 后，就能成功拉取私有镜像。 |
| **创建/更新 (声明式)** | `kubectl apply -f secret.yaml` | **作用**: **推荐方式**。通过 YAML 文件管理 Secret，注意 value 需要手动进行 Base64 编码。<br>**效果**: 创建或更新 Secret。与 ConfigMap 类似，Pod 可以将其作为环境变量或文件挂载使用。 |
| **查看详情(解码)** | `kubectl get secret <name> -o yaml` | **作用**: 查看 Secret 的详细内容。Base64 编码的值需要手动解码才能看到原文。<br>**效果**: 输出 Secret 的 YAML 格式定义，可以看到编码后的数据。 |
| **删除** | `kubectl delete secret <name>` | **作用**: 删除一个 Secret。<br>**效果**: Secret 对象被删除。依赖此 Secret 的 Pod 可能会认证失败或无法启动。 |

---

### 9. PersistentVolume (PV - 持久卷)

*   **资源简介**: 由集群管理员提供的、独立于 Pod生命周期的一块网络存储。它是存储资源的“供给方”，而 PVC (PersistentVolumeClaim) 是“需求方”。

> **核心关系**:
> 1.  **管理员** 创建 **PV**，指向一块实际的物理存储（如一块 NFS 目录、一个云硬盘）。
> 2.  **用户** 创建 **PVC**，声明需要多大、何种类型的存储。
> 3.  **K8s** 将符合条件的 **PV** 和 **PVC** 进行“绑定”(Bind)。
> 4.  **Pod** 在其 `volumes` 定义中引用 **PVC**，从而像使用本地目录一样使用这块持久化存储。

| 操作 (Operation) | 常用命令 (Common Command) | 作用与效果 (Purpose & Effect) |
| :--- | :--- | :--- |
| **查看** | `kubectl get pv` | **作用**: 查看集群中所有可用的持久卷。这是一个**集群级别**的资源，不属于任何命名空间。<br>**效果**: 显示 PV 列表，包括其容量、访问模式、回收策略、状态（`Available`, `Bound`）以及绑定的 PVC。 |
| **创建/更新** | `kubectl apply -f pv.yaml` | **作用**: 通常由集群管理员操作，用于向集群中添加一块可用的存储资源。<br>**效果**: 集群中新增一个状态为 `Available` 的 PV，等待被 PVC 申请和绑定。 |
| **查看详情** | `kubectl describe pv <pv-name>` | **作用**: 查看 PV 的详细信息。<br>**效果**: 显示 PV 的所有配置，包括其类型（如 **NFS**、Ceph、HostPath 等）、服务器地址、路径以及当前的绑定状态。 |
| **删除** | `kubectl delete pv <pv-name>` | **作用**: 从集群中移除一个持久卷的定义。<br>**效果**: PV 对象被删除。根据其回收策略（Reclaim Policy），底层的物理存储**可能被保留(Retain)、回收(Recycle)或删除(Delete)**。 |

*   **关于 NFS**: NFS (Network File System) 只是众多可用于创建 PV 的**存储类型之一**。在 `pv.yaml` 文件中，你会指定 `spec.nfs.server` 和 `spec.nfs.path` 来告诉 K8s 这块存储在哪里。

---

### 10. Job & CronJob (任务 & 定时任务)

*   **资源简介**:
    *   **Job**: 用于执行一次性的、会最终结束的任务。它会创建一个或多个 Pod，并确保指定数量的 Pod 成功运行到完成。非常适合批处理、数据迁移、备份等场景。
    *   **CronJob**: 在 Job 的基础上增加了定时调度功能，类似 Linux 的 Crontab。它会按照预定的时间表（Cron 格式）周期性地创建 Job。

| 操作 (Operation) | 常用命令 (Common Command) | 作用与效果 (Purpose & Effect) |
| :--- | :--- | :--- |
| **查看 Job** | `kubectl get jobs` | **作用**: 查看所有 Job 的状态。<br>**效果**: 显示 Job 列表及其完成情况（如 `1/1 Completions`）。 |
| **查看 CronJob** | `kubectl get cronjobs` (或 `get cj`) | **作用**: 查看所有定时任务的配置。<br>**效果**: 显示 CronJob 列表、它的调度计划（SCHEDULE）、上次调度时间等。 |
| **创建/更新** | `kubectl apply -f my-job.yaml` <br> `kubectl apply -f my-cronjob.yaml` | **作用**: 提交一个一次性任务或定时任务。<br>**效果**: **对于 Job**：立即创建一个 Pod 来执行任务。**对于 CronJob**：不立即执行，而是等待下一个调度时间点到达时，自动创建一个 Job。 |
| **查看任务Pod日志** | `kubectl logs -l job-name=<job-name>` | **作用**: 查看由特定 Job 创建的 Pod 的日志，这是判断任务执行结果的关键。<br>**效果**: 输出任务执行过程中的日志信息。 |
| **删除** | `kubectl delete job <name>` <br> `kubectl delete cj <name>` | **作用**: 删除 Job 或 CronJob。<br>**效果**: 删除 CronJob 会停止未来的所有调度。删除 Job 会**同时删除它创建的所有 Pod**。 |

---

### 11. NetworkPolicy (网络策略)

*   **资源简介**: 为 Pod 提供网络层面的访问控制，类似于防火墙规则。它允许你精细化地定义哪些 Pod 可以相互通信，以及哪些外部流量可以访问 Pod。**注意：你的集群必须使用支持 NetworkPolicy 的网络插件（如 Calico, Cilium, Weave Net）才能使其生效。**

| 操作 (Operation) | 常用命令 (Common Command) | 作用与效果 (Purpose & Effect) |
| :--- | :--- | :--- |
| **查看** | `kubectl get networkpolicy` (或 `get netpol`) | **作用**: 查看当前命名空间下的所有网络策略。<br>**效果**: 显示已定义的网络策略列表。 |
| **创建/更新** | `kubectl apply -f my-policy.yaml` | **作用**: **唯一常用方式**。通过 YAML 文件定义复杂的网络隔离规则。<br>**效果**: 网络插件会根据策略更新底层的防火墙规则（如 iptables）。例如，你可以定义“只有标签为 `role=frontend` 的 Pod 才能访问标签为 `role=backend` 的 Pod 的 80 端口”。 |
| **查看详情** | `kubectl describe netpol <name>` | **作用**: 查看一个网络策略的具体规则。<br>**效果**: 详细列出该策略应用的 Pod (PodSelector)，以及允许的入口(Ingress)和出口(Egress)规则。 |
| **删除** | `kubectl delete netpol <name>` | **作用**: 删除一个网络策略。<br>**效果**: 该策略定义的访问限制被移除，网络通信恢复到策略不存在时的状态（通常是命名空间内或集群内默认互通）。 |


### 总结

| 资源/工具                     | 核心功能                     |
| :------------------------ | :----------------------- |
| **Namespace**             | 逻辑隔离，组织资源                |
| **Deployment**            | 应用部署，管理 Pod 生命周期、扩缩容和更新  |
| **Service**               | 服务发现，提供稳定的 Pod 访问入口和负载均衡 |
| **PVC**                   | 申请持久化存储，解耦应用和存储          |
| **Ingress**               | L7 流量入口，管理外部 HTTP/S 访问   |
| **Helm**                  | 包管理，简化复杂应用的部署和生命周期管理     |
| **ConfigMap**             | 存储和管理**非敏感**配置数据         |
| **Secret**                | 存储和管理**敏感**数据（密码、密钥等）    |
| **PersistentVolume (PV)** | **供给**持久化存储资源（由管理员创建）    |
| **Job**                   | 执行**一次性**、会结束的批处理任务      |
| **CronJob**               | **定时调度**执行 Job           |
| **NetworkPolicy**         | Pod 间的**防火墙**，控制网络流量     |

对于日常用户来说，`kubectl get`, `kubectl describe`, `kubectl logs`, `kubectl apply -f` 和 `helm install/upgrade/uninstall` 是使用频率最高、也最需要熟练掌握的命令。